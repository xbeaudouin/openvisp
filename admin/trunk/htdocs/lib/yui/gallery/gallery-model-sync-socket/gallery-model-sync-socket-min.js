YUI.add("gallery-model-sync-socket",function(h){var d=h.Lang,c=d.sub,g=d.isValue,a=d.isString,b=d.isNumber,f=d.isFunction;function e(){}e._NON_ATTRS_CFG=["root","url"];e.prototype={root:"",url:function(){var i=this.root,j;if(this._isYUIModelList||this.isNew()){return i;}j=this.getAsURL("id");if(i&&i.charAt(i.length-1)==="/"){j+="/";}return this._joinURL(j);},initializer:function(i){i||(i={});g(i.url)&&(this.url=i.url);},onSocket:function(l,p,o,k){var j=this._ioEvents||(this._ioEvents={}),n=this._getURL()+":"+l,i=this;if(f(p)){k=o;o=p;p=window.socket||this.socket;}var m={type:l,global:n,localCallback:o,globalCallback:function(q){i.fire(l,q);}};this.on(m.type,m.localCallback,(k||i));p.on(m.global,m.globalCallback);if(!j[m.name]){j[m.name]=[m];}else{j[m.name].push(m);}return this;},detachSocket:function(o,m,p){var l=this._ioEvents||(this._ioEvents={}),n=this._getURL()+":"+o,r=this;if(f(m)){p=m;m=this.socket||window.socket||h.socket;}var q=l[o];if(h.isEmpty(q)){if(p&&f(p)){for(var j=0,k=q.length;j<k;j++){if(p==q[j].localCallback){this.detach(q[j].type,q[j].localCallback);m.removeListener(q[j].global,q[j].globalCallback);q[j]=false;}}q=h.Array.filter(q);}else{this.detach(o);m.removeAllListeners(n);}if(q.length===0){delete l[o];}}return this;},detachAllSockets:function(k){var j=this._ioEvents||(this._ioEvents={});if(!k){k=this.socket||window.socket||h.socket;}for(var i in j){this.detachSocket(i,k);}return this;},sync:function(l,i,o){var k=this._getURL().split("/"),j=(k[0]!=="")?k[0]:k[1];l=(l==="create")?"construct":l;var m=h.mix(i,{req:j+":"+l});if(!m.data){m.data=this.toJSON()||{};}var n=window.socket||h.socket;n.emit(j+":"+l,m.data,function(p,q){if(p){o(p);}else{o(null,q);}});},_getURL:function(){var i=this.url;if(f(i)){return this.url();}if(i.charAt(0)==="/"){i=i.substring(1);}if(this._isYUIModel){data={};h.Object.each(this.toJSON(),function(l,j){if(a(l)||b(l)){data[j]=encodeURIComponent(l);}});i=c(i,data);}return i||this.root;},_joinURL:function(j){var i=this.root;if(j.charAt(0)==="/"){j=j.substring(1);}if(i.charAt(0)==="/"){i=i.substring(1);}return i&&i.charAt(i.length-1)==="/"?i+j:i+"/"+j;}};h.namespace("ModelSync").Socket=e;},"gallery-2012.07.11-21-38",{requires:["model","model-list","json-stringify"],skinnable:false});