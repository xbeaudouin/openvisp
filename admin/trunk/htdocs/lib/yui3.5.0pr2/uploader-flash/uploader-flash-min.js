/*
YUI 3.5.0pr2 (build 4560)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("uploader-flash",function(d){var b=d.substitute,c=d.Uploader.Queue;function a(e){a.superclass.constructor.apply(this,arguments);}d.UploaderFlash=d.extend(a,d.Widget,{_swfReference:null,_uploaderQueue:null,_swfContainerId:null,initializer:function(){this._swfContainerId=d.guid("uploader");this.publish("fileselect");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");},_uploadEventHandler:function(e){switch(e.type){case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.fire("alluploadscomplete",e);break;case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;}},_setMultipleFiles:function(){if(this._swfReference){this._swfReference.callSWF("setAllowMultipleFiles",[this.get("multipleFiles")]);}},_setFileFilters:function(){if(this._swfReference&&this.get("fileFilters")!=null){this._swfReference.callSWF("setFileFilters",[this.get("fileFilters")]);}},_updateFileList:function(h){var g=h.fileList,j=[],f=[],e=this._swfReference;d.each(g,function(l){var k={};k.id=l.fileId;k.name=l.fileReference.name;k.size=l.fileReference.size;k.type=l.fileReference.type;k.dateCreated=l.fileReference.creationDate;k.dateModified=l.fileReference.modificationDate;k.uploader=e;j.push(k);});d.each(j,function(k){f.push(new d.File(k));});this.fire("fileselect",{fileList:f});var i=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?i.concat(f):f);},renderUI:function(){var e=this.get("contentBox");e.append(this.get("selectFilesButton"));e.append(d.Node.create(b(a.FLASH_CONTAINER,{swfContainerId:this._swfContainerId})));var f=d.one("#"+this._swfContainerId);var g={version:"10.0.45",fixedAttributes:{wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",scale:"noscale"},};this._swfReference=new d.SWF(f,this.get("swfURL"),g);},bindUI:function(){this._swfReference.on("swfReady",function(){this._setMultipleFiles();this._setFileFilters();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("fileFiltersChange",this._setFileFilters,this);},this);this._swfReference.on("fileselect",this._updateFileList,this);},upload:function(h,f,i){var g=f||this.get("uploadURL"),e=i||this.get("postVarsPerFile");if(h instanceof d.File){this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:[h],uploadURL:g,perFileParameters:e});this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.set("fileFieldName",this.get("fileFieldName"));this._uploaderQueue.startUpload();}},uploadAll:function(f,h){console.log("Starting upload of all selected files");var g=f||this.get("uploadURL"),e=h||this.get("postVarsPerFile");console.log("Creating a new instance of upload queue");this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:this.get("fileList"),uploadURL:g,perFileParameters:e});console.log("Subscribing to uploaderqueue's events");this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.set("fileFieldName",this.get("fileFieldName"));console.log("Starting upload in the queue");this._uploaderQueue.startUpload();},uploadThese:function(i,f,h){var g=f||this.get("uploadURL"),e=h||this.get("postVarsPerFile");this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:i,uploadURL:g,perFileParameters:e});this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.on("uploaderror",this._uploadEventHandler,this);this._uploaderQueue.set("fileFieldName",this.get("fileFieldName"));this._uploaderQueue.startUpload();}},{FLASH_CONTAINER:"<div id='{swfContainerId}' style='position:absolute; top:0px; left: 0px; width:100%; height:100%'></div>",NAME:"uploader",ATTRS:{selectFilesButton:{value:d.Node.create("<button type='button' style='height:100%;width:100%'>Select Files</button>")},multipleFiles:{value:false},fileFilters:{value:null},fileFieldName:{value:"Filedata"},appendNewFiles:{value:true},simLimit:{value:2,validator:function(f,e){return(f>=2&&f<=5);}},fileList:{value:[]},postVarsPerFile:{value:{}},uploadURL:{value:""},swfURL:{value:"assets/flashuploader.swf"}}});d.UploaderFlash.Queue=c;},"3.5.0pr2",{requires:["swf","widget","substitute","base","node","event-custom","file","uploader-queue"]});