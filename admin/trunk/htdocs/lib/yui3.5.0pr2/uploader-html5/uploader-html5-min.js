/*
YUI 3.5.0pr2 (build 4560)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("uploader-html5",function(d){var a=d.substitute,c=d.Uploader.Queue;function b(e){b.superclass.constructor.apply(this,arguments);}d.UploaderHTML5=d.extend(b,d.Widget,{_fileInputField:null,_uploaderQueue:null,initializer:function(){this.publish("fileselect");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");},_uploadEventHandler:function(e){switch(e.type){case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.fire("alluploadscomplete",e);break;case"uploaderqueue:uploaderror":this.fire("uploaderror",e);}},_setMultipleFiles:function(){if(this.get("multipleFiles")===true){this._fileInputField.set("multiple","multiple");}else{this._fileInputField.set("multiple","");}},_bindSelectButton:function(){this.get("selectFilesButton").on("click",this.openFileSelectDialog,this);},_updateFileList:function(g){var f=g.target.getDOMNode().files,e=[];d.each(f,function(i){e.push(new d.File(i));});this.fire("fileselect",{fileList:e});var h=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?h.concat(e):e);},openFileSelectDialog:function(){var e=this._fileInputField.getDOMNode();if(e.click){e.click();}},renderUI:function(){var e=this.get("contentBox");e.append(this.get("selectFilesButton"));this._fileInputField=d.Node.create(b.HTML5FILE_FIELD);e.append(this._fileInputField);},bindUI:function(){this._bindSelectButton();this._setMultipleFiles();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("selectFilesButtonChange",this._bindSelectButton,this);this._fileInputField.on("change",this._updateFileList,this);},upload:function(h,f,i){var g=f||this.get("uploadURL"),e=i||this.get("postVarsPerFile");if(h instanceof d.File){this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:[h],uploadURL:g,perFileParameters:e});this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.startUpload();}},uploadAll:function(f,h){var g=f||this.get("uploadURL"),e=h||this.get("postVarsPerFile");this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:this.get("fileList"),uploadURL:g,perFileParameters:e});this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.startUpload();},uploadThese:function(i,f,h){var g=f||this.get("uploadURL"),e=h||this.get("postVarsPerFile");this._uploaderQueue=new c({simUploads:this.get("simLimit"),errorAction:"restart",fileList:i,uploadURL:g,perFileParameters:e});this._uploaderQueue.on("uploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("totaluploadprogress",this._uploadEventHandler,this);this._uploaderQueue.on("uploadcomplete",this._uploadEventHandler,this);this._uploaderQueue.on("alluploadscomplete",this._uploadEventHandler,this);this._uploaderQueue.startUpload();}},{HTML5FILE_FIELD:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",NAME:"uploader",ATTRS:{selectFilesButton:{value:d.Node.create("<button type='button' style='height:100%;width:100%'>Select Files</button>")},dragAndDropArea:{value:null},multipleFiles:{value:false},appendNewFiles:{value:true},simLimit:{value:2,validator:function(f,e){return(f>=2&&f<=5);}},fileFieldName:{value:"Filedata"},fileList:{value:[]},postVarsPerFile:{value:{}},uploadURL:{value:""}}});d.UploaderHTML5.UploaderQueue=c;},"3.5.0pr2",{requires:["widget","substitute","node-event-simulate","file","uploader-queue"]});