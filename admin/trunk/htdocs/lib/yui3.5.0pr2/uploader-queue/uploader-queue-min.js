/*
YUI 3.5.0pr2 (build 4560)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("uploader-queue",function(b){var i=b.Lang,m=b.bind,j=b.config.win,a,c,f,g,h,k,l,e;var d=function(n){a={};c={};f=[];g=0;h=0;k=0;l=0;e=0;d.superclass.constructor.apply(this,arguments);};b.extend(d,b.Base,{_currentState:d.STOPPED,initializer:function(n){},_uploadErrorHandler:function(o){var p=this.get("errorAction");var n=o;n.file=o.target;n.originEvent=o;if(p===d.STOP){this.pauseUpload();}else{if(p===d.RESTART_ASAP||p===d.RESTART_AFTER){f.push(o.target);}}this.fire("uploaderror",n);},_uploadCompleteHandler:function(q){k-=1;l+=q.target.get("size");delete a[q.target.get("id")];delete c[q.target.get("id")];var t=this.get("errorAction");console.log(t);console.log(g<h);console.log(this._currentState===d.UPLOADING);console.log(t===d.STOP);console.log(t===d.CONTINUE);console.log((t===d.STOP||t===d.CONTINUE));if(g<h&&this._currentState===d.UPLOADING&&(t===d.STOP||t===d.CONTINUE)){var o=this.get("fileList")[g],r=o.get("id"),p=this.get("perFileParameters"),s=p.hasOwnProperty(r)?p[r]:p;o.on("uploadprogress",this._uploadProgressHandler,this);o.on("uploadcomplete",this._uploadCompleteHandler,this);o.on("uploaderror",this._uploadErrorHandler,this);o.startUpload(this.get("uploadURL"),s,this.get("fileFieldName"));a[o.get("id")]=0;c[o.get("id")]=o;g+=1;}else{if(this._currentState===d.UPLOADING&&t===d.RESTART_ASAP&&f.length>0){var o=f.shift(),r=o.get("id"),p=this.get("perFileParameters"),s=p.hasOwnProperty(r)?p[r]:p;o.on("uploadprogress",this._uploadProgressHandler,this);o.on("uploadcomplete",this._uploadCompleteHandler,this);o.on("uploaderror",this._uploadErrorHandler,this);o.startUpload(this.get("uploadURL"),s,this.get("fileFieldName"));a[o.get("id")]=0;c[o.get("id")]=o;}}var n=q;n.file=q.target;n.originEvent=q;this.fire("uploadcomplete",n);if(k==0){this.fire("alluploadscomplete");}},_uploadProgressHandler:function(q){a[q.target.get("id")]=q.bytesLoaded;var p=q;p.originEvent=q;p.file=q.target;this.fire("uploadprogress",p);var o=l;b.each(a,function(r){o+=r;});var n=Math.min(100,Math.round(10000*o/e)/100);this.fire("totaluploadprogress",{bytesLoaded:o,bytesTotal:e,percentLoaded:n});},startUpload:function(){a={};c={};f=[];k=h;g=0;l=0;this._currentState=d.UPLOADING;while(g<this.get("simUploads")&&g<h){var o=this.get("fileList")[g],n=o.get("id"),p=this.get("perFileParameters"),q=p.hasOwnProperty(n)?p[n]:p;a[n]=0;c[n]=o;o.on("uploadprogress",this._uploadProgressHandler,this);o.on("uploadcomplete",this._uploadCompleteHandler,this);o.on("uploaderror",this._uploadErrorHandler,this);o.startUpload(this.get("uploadURL"),q,this.get("fileFieldName"));g+=1;}},pauseUpload:function(){this._currentState=d.STOPPED;},restartUpload:function(){this._currentState=d.UPLOADING;if(g<h){var n=this.get("fileList")[g],p=n.get("id"),o=this.get("perFileParameters"),q=o.hasOwnProperty(p)?o[p]:o;n.on("uploadprogress",this._uploadProgressHandler,this);n.on("uploadcomplete",this._uploadCompleteHandler,this);n.on("uploaderror",this._uploadErrorHandler,this);n.startUpload(this.get("uploadURL"),q,this.get("fileFieldName"));a[n.get("id")]=0;c[n.get("id")]=n;g+=1;}},cancelUpload:function(){var n=this.get("fileList");for(fid in c){c[fid].cancel();}a={};c={};f=[];k=h;g=0;l=0;}},{CONTINUE:"continue",STOP:"stop",RESTART_ASAP:"restartasap",RESTART_AFTER:"restartafter",STOPPED:"stopped",UPLOADING:"uploading",NAME:"uploaderqueue",ATTRS:{simUploads:{value:2,validator:function(o,n){return(o>=2&&o<=5);}},errorAction:{value:"continue",validator:function(o,n){return(o===d.CONTINUE||o===d.STOP||o===d.RESTART_ASAP||o===d.RESTART_AFTER);}},bytesUploaded:{readOnly:true,value:0},bytesTotal:{readOnly:true,value:0},fileList:{value:[],lazyAdd:false,setter:function(o){var n=o;b.each(n,function(p){e+=p.get("size");});h=k=n.length;return o;}},fileFieldName:{value:"Filedata"},uploadURL:{value:""},perFileParameters:{value:{}}}});b.namespace("Uploader");b.Uploader.Queue=d;},"3.5.0pr2",{requires:["base"]});